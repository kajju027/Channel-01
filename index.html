<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tmkc</title>

<!-- Shaka Player UI CSS -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css">

<style>
body, html {
    margin: 0;
    padding: 0;
    background: #000;
    height: 100%;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

#player-container {
    width: 100%;
    max-width: 100%;
    aspect-ratio: 16/9;
    position: relative;
    background: black;
}

video.shaka-video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: black;
}

/* Poster overlay (visible until video starts) */
#poster-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    z-index: 10;
    transition: opacity 0.5s ease;
}

/* Ensure Shaka controls visible above video */
.shaka-controls-container {
    z-index: 9 !important;
    background: transparent !important;
}

.shaka-controls-button-panel button {
    display: inline-block !important;
}
</style>
</head>
<body>

<div id="player-container">
    <!-- Poster overlay (add your image URL below) -->
    <div id="poster-overlay"
         style="background-image: url('https://example.com/poster.jpg');"></div>

    <video id="video" autoplay playsinline muted class="shaka-video"></video>
</div>

<!-- Shaka Player JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const video = document.getElementById('video');
    const container = document.getElementById('player-container');
    const posterOverlay = document.getElementById('poster-overlay');

    // Initialize Shaka Player
    const player = new shaka.Player(video);
    const ui = new shaka.ui.Overlay(player, container, video);

    player.addEventListener('error', e => console.error('Error code', e.detail.code, 'object', e.detail));

    // Configure UI controls
    ui.configure({
        controlPanelElements: [
            'play_pause',
            'mute',
            'volume',
            'spacer',
            'settings',
            'quality',
            'playback_rate',
            'picture_in_picture',
            'fullscreen'
        ],
        settingsMenuElements: [
            'quality',
            'playback_rate'
        ]
    });

    // Configure player
    player.configure({
        drm: {
            clearKeys: {
                'a6dfc4f17d70d8d07639659193f03b25': '893eacfabe386144b81733d622a7ad17'
            }
        },
        abr: { enabled: true } // Auto bitrate
    });

    const manifestUri = 'https://live2.shoq.com.pk/live/eds/ICC_Women_World_Cup_2025/DASH/ICC_Women_World_Cup_2025.mpd';

    try {
        await player.load(manifestUri);
        console.log('âœ… Stream loaded successfully');

        // Force 396p default if available
        const tracks = player.getVariantTracks();
        const track396 = tracks.find(t => t.height === 396);
        if (track396) {
            await player.selectVariantTrack(track396, /* clearBuffer= */ true);
            player.configure({ abr: { enabled: false } }); // lock resolution
            console.log('ðŸŽ¥ Default resolution set to 396p');
        }

    } catch (error) {
        console.error('âŒ Error loading stream:', error);
    }

    // Hide poster when playback starts
    video.addEventListener('playing', () => {
        posterOverlay.style.opacity = '0';
        setTimeout(() => posterOverlay.style.display = 'none', 500);
    });
});
</script>

</body>
</html>
